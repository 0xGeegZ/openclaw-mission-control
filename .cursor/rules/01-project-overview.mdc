---
description: Overview of Mission Control project and its structure.
globs:
alwaysApply: true
---

# Mission Control — Project Overview

**IMPORTANT:** Before implementing ANY changes, read the foundational documentation:
- `docs/mission-control-initial-article.md` — Original concept and vision
- `docs/mission-control-cursor-core-instructions.md` — Core engineering instructions
- `docs/build/00-orchestrator.md` — Build orchestration and module plans

## What is Mission Control?

Mission Control is a **multi-agent coordination SaaS** built on top of **OpenClaw (Clawdbot)**. It provides:

- **Shared Brain**: Tasks, threads, documents, activity feed (Convex backend)
- **Agent Runtime**: Per-account servers running OpenClaw gateway and sessions
- **Dashboard UI**: Kanban board, agent roster, task threads, notifications

The core premise: AI agents behave like a **real team** — with roles, persistent context, and tracked collaboration.

## Tech Stack

| Layer | Technology | Notes |
|-------|------------|-------|
| **Frontend** | Next.js 16 (App Router), React 19 | TypeScript strict mode |
| **UI** | shadcn/ui, Tailwind CSS v4 | Radix primitives, lucide-react icons |
| **Backend** | Convex | Real-time DB, server functions, auth |
| **Auth** | Clerk | Via @clerk/nextjs |
| **Agent Runtime** | OpenClaw (Clawdbot) | Sessions, gateway, cron/heartbeat |
| **Runtime Servers** | DigitalOcean Droplets | One per customer account |
| **Monorepo** | Turborepo | Shared packages between apps |

## Monorepo Structure

```
mission-control/
├── apps/
│   ├── web/                      # Next.js web app (main product)
│   │   ├── app/
│   │   │   ├── (auth)/           # Auth pages (sign-in, sign-up)
│   │   │   ├── (dashboard)/      # Protected dashboard routes
│   │   │   │   ├── [accountSlug]/
│   │   │   │   │   ├── tasks/    # Kanban board + task detail
│   │   │   │   │   ├── agents/   # Agent roster
│   │   │   │   │   ├── docs/     # Documents
│   │   │   │   │   ├── feed/     # Activity feed
│   │   │   │   │   └── settings/ # Account settings
│   │   ├── components/           # App-specific components
│   │   │   ├── dashboard/        # Sidebar, AccountSwitcher, etc.
│   │   │   ├── tasks/            # KanbanBoard, TaskCard, etc.
│   │   │   ├── agents/           # AgentCard, CreateAgentDialog
│   │   │   └── feed/             # ActivityItem, ActivityFeed
│   │   └── lib/                  # App-specific utilities
│   │       └── hooks/            # useAccount, etc.
│   │
│   ├── native/                   # React Native app (v2, placeholder)
│   │
│   └── runtime/                  # Per-account runtime service
│       ├── src/
│       │   ├── gateway.ts        # OpenClaw gateway manager
│       │   ├── delivery.ts       # Notification delivery loop
│       │   ├── heartbeat.ts      # Agent heartbeat scheduler
│       │   └── health.ts         # Health check endpoint
│       └── Dockerfile
│
├── packages/
│   ├── backend/                  # Convex backend
│   │   └── convex/
│   │       ├── schema.ts         # Database schema (9 tables)
│   │       ├── lib/              # Auth guards, validators, helpers
│   │       │   ├── auth.ts       # requireAuth, requireAccountMember
│   │       │   ├── validators.ts # Shared validators
│   │       │   ├── activity.ts   # Activity logging
│   │       │   ├── mentions.ts   # Mention parsing
│   │       │   └── notifications.ts
│   │       ├── accounts.ts       # Account CRUD
│   │       ├── memberships.ts    # Membership CRUD
│   │       ├── tasks.ts          # Task CRUD + workflow
│   │       ├── agents.ts         # Agent management
│   │       ├── messages.ts       # Messages + mentions
│   │       ├── documents.ts      # Document management
│   │       ├── activities.ts     # Activity feed
│   │       ├── notifications.ts  # Notification system
│   │       ├── subscriptions.ts  # Thread subscriptions
│   │       └── service/          # Service-only functions (runtime)
│   │
│   ├── ui/                       # Shared UI components (shadcn)
│   │   └── src/
│   │       ├── components/       # shadcn components
│   │       ├── hooks/            # Shared hooks
│   │       ├── lib/              # Utilities (cn, etc.)
│   │       └── styles/           # Global CSS
│   │
│   └── shared/                   # Shared types/constants
│       └── src/
│           ├── types/            # TaskStatus, AgentStatus, etc.
│           └── constants/        # TASK_STATUS_ORDER, etc.
│
└── docs/
    ├── build/                    # Build plans for agents
    ├── mission-control-initial-article.md
    └── mission-control-cursor-core-instructions.md
```

## Key Database Tables (Convex)

| Table | Purpose | Key Fields |
|-------|---------|------------|
| `accounts` | Multi-tenant accounts | `name`, `slug`, `runtimeStatus` |
| `memberships` | User-account relationships | `userId`, `accountId`, `role` |
| `agents` | AI agent definitions | `sessionKey`, `status`, `soulContent` |
| `tasks` | Kanban tasks | `status`, `assignedAgentIds`, `priority` |
| `messages` | Task thread comments | `taskId`, `content`, `mentions` |
| `documents` | Markdown deliverables | `title`, `content`, `type` |
| `activities` | Audit trail | `type`, `actorId`, `targetId` |
| `notifications` | Delivery queue | `recipientType`, `deliveredAt` |
| `subscriptions` | Thread subscriptions | `taskId`, `subscriberId` |

## Core Invariants

### Multi-Tenancy (CRITICAL)
- **Every table has `accountId`** (except `accounts` itself)
- **Every query filters by `accountId`**
- **No cross-account data access** ever

### OpenClaw Integration
- **Session Key Format**: `agent:{slug}:{accountId}`
- **Runtime servers**: One DigitalOcean Droplet per customer
- **Notification flow**: Convex → Runtime → OpenClaw session

### Task Workflow
```
inbox → assigned → in_progress → review → done
           ↓            ↓
        blocked ←────────┘
```

## Development Rules

### General
- Use `@` for absolute imports from project root
- Use `@packages/*` for shared package imports
- TypeScript strict mode everywhere
- Functional programming patterns (no classes)

### Convex Backend
- **snake_case** for all files in `convex/` (required for API dot notation)
- Always use `.withIndex()` for queries (no full table scans)
- Auth guards on every query/mutation: `requireAuth()`, `requireAccountMember()`
- Log activities for all state changes

### Frontend
- **PascalCase** for React component files
- **kebab-case** for directories
- Server components by default, `"use client"` only when needed
- Use shadcn/ui components from `@packages/ui/components/*`
- Use `cn()` from `@packages/ui/lib/utils` for class names

### Import Patterns

```typescript
// Convex
import { api } from "@packages/backend/convex/_generated/api";
import { Id, Doc } from "@packages/backend/convex/_generated/dataModel";

// UI
import { Button } from "@packages/ui/components/button";
import { cn } from "@packages/ui/lib/utils";

// Shared
import { TaskStatus, TASK_STATUS_ORDER } from "@packages/shared";

// App-local
import { useAccount } from "@/lib/hooks/useAccount";
import { KanbanBoard } from "@/components/tasks/KanbanBoard";
```

## Authentication (Clerk)

- Users authenticate via Clerk in the web app
- Clerk identity available in Convex via `ctx.auth.getUserIdentity()`
- Membership checked via `memberships` table
- Service calls use separate auth tokens (not user tokens)

## Real-time Updates

- Use `useQuery()` for automatic subscriptions
- Convex handles caching and real-time sync
- UI updates immediately when data changes

## Environment Variables

### Web App (.env.local)
```
NEXT_PUBLIC_CONVEX_URL=
NEXT_PUBLIC_CLERK_PUBLISHABLE_KEY=
CLERK_SECRET_KEY=
```

### Runtime Service
```
ACCOUNT_ID=
CONVEX_URL=
SERVICE_TOKEN=
```

## Build Plans Location

Detailed implementation plans are in `docs/build/`:
- `00-orchestrator.md` — Master orchestration guide
- `phase-1-foundation/` — Project setup, schema
- `phase-2-backend/` — Auth, tasks, agents, documents
- `phase-3-communication/` — Messages, notifications, UI layout
- `phase-4-features/` — Kanban, task detail, runtime

**Each module plan references the core documentation and must be followed precisely.**

## Quick Reference

### Start Development
```bash
yarn install
npx convex dev          # Terminal 1
yarn dev                # Terminal 2
```

### Add shadcn Component
```bash
cd apps/web
npx shadcn@latest add [component]
```

### Type Check
```bash
yarn typecheck
```

### Run Lint
```bash
yarn lint
```
